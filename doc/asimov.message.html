<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>asimov.message documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Asimov 0.1.0-SNAPSHOT API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>asimov</span></div></div></li><li class="depth-2 branch"><a href="asimov.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2 branch current"><a href="asimov.message.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message</span></div></a></li><li class="depth-2 branch"><a href="asimov.tcpros.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tcpros</span></div></a></li><li class="depth-2 branch"><a href="asimov.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="asimov.xmlrpc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>xmlrpc</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="asimov.message.html#var-annotate"><div class="inner"><span>annotate</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-annotate-all"><div class="inner"><span>annotate-all</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-annotate-md5"><div class="inner"><span>annotate-md5</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-annotate-md5s"><div class="inner"><span>annotate-md5s</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-cat"><div class="inner"><span>cat</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-check-errors"><div class="inner"><span>check-errors</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-declaration-frame"><div class="inner"><span>declaration-frame</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-declarations"><div class="inner"><span>declarations</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-dep-graph"><div class="inner"><span>dep-graph</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-dependencies"><div class="inner"><span>dependencies</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-ensure-complete-dependencies"><div class="inner"><span>ensure-complete-dependencies</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-ensure-nocycles"><div class="inner"><span>ensure-nocycles</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-frame"><div class="inner"><span>frame</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-literal"><div class="inner"><span>literal</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-make-packages-explicit"><div class="inner"><span>make-packages-explicit</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-md5-text"><div class="inner"><span>md5-text</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-message-frame"><div class="inner"><span>message-frame</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-message-grammar"><div class="inner"><span>message-grammar</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-msg-parser"><div class="inner"><span>msg-parser</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-msgs-in-dir"><div class="inner"><span>msgs-in-dir</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-parse-id"><div class="inner"><span>parse-id</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-parse-path"><div class="inner"><span>parse-path</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-primitive-frame"><div class="inner"><span>primitive-frame</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-primitive-type"><div class="inner"><span>primitive-type</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-serealize-declaration"><div class="inner"><span>serealize-declaration</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-serialize-id"><div class="inner"><span>serialize-id</span></div></a></li><li class="depth-1"><a href="asimov.message.html#var-transform-parse"><div class="inner"><span>transform-parse</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">asimov.message</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-annotate"><h3>annotate</h3><div class="usage"><code>(annotate msgs k f)</code></div><div class="doc"><pre class="plaintext">A higher order function to help with compiler steps
that annotate each message with a new transformation result.

Expects:
 msgs:map The entire message map to be compiled.
 k:keyword The key the new intermediary result is to be associated with.
 f:fn The transformation function to be applied to each message definition.
 
Returns the message map where each message definition map has been passed to
the provided function. The result is then associated to it under the given key.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L411">view source</a></div></div><div class="public anchor" id="var-annotate-all"><h3>annotate-all</h3><div class="usage"><code>(annotate-all msgs)</code></div><div class="doc"><pre class="plaintext">Compiling messages just means applying all compiler annotation steps to a raw message map.

Expects:
 msgs:map The entire message map to be compiled.

Returns the given message map with all properties needed and generated
by compilation annotated to each message.
Throws an exception if the a message or the dependency graph is malformed somehow.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L541">view source</a></div></div><div class="public anchor" id="var-annotate-md5"><h3>annotate-md5</h3><div class="usage"><code>(annotate-md5 msg msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step to calculate md5 sums for single messages.

Expects:
 msg:map A single message definition map.
 msgs:map The entire message map to be compiled.

Returns the message definition with the md5 sum annotated to it.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L346">view source</a></div></div><div class="public anchor" id="var-annotate-md5s"><h3>annotate-md5s</h3><div class="usage"><code>(annotate-md5s msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step to calculate md5 sums for all messages.
Messages are automatically ordered so that the dependency
graph is annotated bottom up.

Expects:
 msgs:map The entire message map to be compiled.

Returns the provided message map where each message definition is annotated with its md5 sum.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L359">view source</a></div></div><div class="public anchor" id="var-cat"><h3>cat</h3><div class="usage"><code>(cat msg msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step to calculate  `gendeps --cat` texts for single messages.
In addition to the md5 sum, ros uses a message definition where all the
dependencies are concatenated into a single text during handshakes.
To be used with `annotate`.

Expects:
 msg:map A single message definition map.
 msgs:map The entire message map to be compiled.

Returns the cat text of the provided message definition.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L384">view source</a></div></div><div class="public anchor" id="var-check-errors"><h3>check-errors</h3><div class="usage"><code>(check-errors msg p)</code></div><div class="doc"><pre class="plaintext">Compiler step that checks for parsing errors.

Expects:
 msg:string The raw unparsed message used for error reporting.
 p:instaparse-parse The parsed version of the message,
   potentially containing errors.

Returns the parsed message when parsing was successful.

Thows an exception when the message definitions parse contains any errors.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L144">view source</a></div></div><div class="public anchor" id="var-declaration-frame"><h3>declaration-frame</h3><div class="usage"><code>(declaration-frame d msgs)</code></div><div class="doc"><pre class="plaintext">Each declaration in a message definition has to be turned into a serializer and deserializer
in order to send and receive messages.

Expects:
 d:map A single declaration of a message definition.
 msgs:map The entire message map to be compiled.

Returns a gloss frame to encode and decode the given declaration.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L445">view source</a></div></div><div class="public anchor" id="var-declarations"><h3>declarations</h3><div class="usage"><code>(declarations {:keys [package raw], :as msg} msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step for turning the raw message definition into separate declarations.
To be used with `annotate`.

Expects:
 msg:map The message definition map consisting of a package name (:package)
         and the raw message declaration (:raw).
 msgs:map The entire message map to be compiled.

Returns a vector of the message definitions declarations.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L161">view source</a></div></div><div class="public anchor" id="var-dep-graph"><h3>dep-graph</h3><div class="usage"><code>(dep-graph msgs)</code></div><div class="doc"><pre class="plaintext">Calculates a message definition maps dependency graph.

Expects:
 msgs:map The message definitions for which the graph is to be calculated.

Returns a map where each key represents a node in the graph and each value is a set
of child nodes.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L231">view source</a></div></div><div class="public anchor" id="var-dependencies"><h3>dependencies</h3><div class="usage"><code>(dependencies msg msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step for extracting a messages dependencies from its declarations.
To be used with `annotate`.

Expects:
 msg:map The message definition map consisting of a collection of declarations (:declarations).
 msgs:map The entire message map to be compiled.

Returns a vector of the messages depencencies in the order they appeared.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L178">view source</a></div></div><div class="public anchor" id="var-ensure-complete-dependencies"><h3>ensure-complete-dependencies</h3><div class="usage"><code>(ensure-complete-dependencies msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step to ensure that the provided message definition map
is closed in regards to each messages dependencies.

Expects:
 msgs:map The message definitions to check.

Returns the given message definitions as is when all dependencies are satisfied.

Throw an exception if any message definitions depencency can&apos;t be satisfied.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L243">view source</a></div></div><div class="public anchor" id="var-ensure-nocycles"><h3>ensure-nocycles</h3><div class="usage"><code>(ensure-nocycles msgs)</code></div><div class="doc"><pre class="plaintext">A compiler step to ensure that the provided message definition map does not
contain cyclic dependencies.

Expects:
 msgs:map The message definitions to check.

Returns the given message definitions as is when no dependencies are cyclic.

Throw an exception if cycles are found in the dependency tree.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L268">view source</a></div></div><div class="public anchor" id="var-frame"><h3>frame</h3><div class="usage"><code>(frame msg msgs)</code></div><div class="doc"><pre class="plaintext">Toplevel message definitions require a special header,
in comparison with embedded messages.

Expects:
 msg:map A single message definition.
 msgs:map The entire message map to be compiled.

Returns a gloss frame to encode and decode the messages described by the given definition.
To be used for toplevel messages.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L527">view source</a></div></div><div class="public anchor" id="var-literal"><h3>literal</h3><div class="usage"><code>(literal f)</code></div><div class="doc"><pre class="plaintext">Generates an instaparse leaf transformer for literal value tokens.

Expects:
 f:fn A parsing function to be applied to the literals.

Returns a function that takes a literal and returns a map
containing it in its raw form (:raw) as well as the value
created by parsing it with the provided function (:read).</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L60">view source</a></div></div><div class="public anchor" id="var-make-packages-explicit"><h3>make-packages-explicit</h3><div class="usage"><code>(make-packages-explicit package declarations)</code></div><div class="doc"><pre class="plaintext">Compiler step that makes implicit package references in a
ros message definition explicit.
For &quot;Header&quot; messages the package is &quot;std_msgs&quot;.
For all other message references without an explicit package
the package the message was declared in will be choosen.

Expects:
 package:string The name of the package the message was declared in.
 declarations:vector The declarations of the message definition.

Returns the given declarations where every message reference is explicit.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L120">view source</a></div></div><div class="public anchor" id="var-md5-text"><h3>md5-text</h3><div class="usage"><code>(md5-text msg msgs)</code></div><div class="doc"><pre class="plaintext">In order to create a md5 checksum for a message definition ros first
tries to bring it into a canonical text representation which is then hashed.
This process is buggy as it cannot distinguish between non-primitive arrays
tuples and variables, but we have to live with it (See the `:pedantic?` flag.).

Expects:
 msg:map The message definition map consisting of declarations (:declarations).
 msgs:map The entire message map to be compiled.

Returns the &quot;canonical&quot; text form of the message to be used for md5 generation.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L325">view source</a></div></div><div class="public anchor" id="var-message-frame"><h3>message-frame</h3><div class="usage"><code>(message-frame msg msgs)</code></div><div class="doc"><pre class="plaintext">Each message definition has to be turned into a serializer and deserializer
in order to send and receive messages.

Expects:
 msg:map A single message definition.
 msgs:map The entire message map to be compiled.

Returns a gloss frame to encode and decode the messages described by the given definition.
To be used as subframes embedded in other messages.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L512">view source</a></div></div><div class="public anchor" id="var-message-grammar"><h3>message-grammar</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L12">view source</a></div></div><div class="public anchor" id="var-msg-parser"><h3>msg-parser</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L45">view source</a></div></div><div class="public anchor" id="var-msgs-in-dir"><h3>msgs-in-dir</h3><div class="usage"><code>(msgs-in-dir root)</code></div><div class="doc"><pre class="plaintext">Loads all messages in the given directory.

Expects:
 root:file The directory to load the messages from.

Returns a message definition map where each key is a map with the messages package (:package) and name (:name)
and every value is a map with the messages package (:package),
name (:name) and its raw string data (:raw).</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L211">view source</a></div></div><div class="public anchor" id="var-parse-id"><h3>parse-id</h3><div class="usage"><code>(parse-id id)</code></div><div class="doc"><pre class="plaintext">Ros employs package/message ids to identify message definitions.
Handling these as clojure maps is a bit nicer.
Inverse of `serialize-id`.

Expects:
 id:string A message definition id string of the form `package_name/message_name`.

Returns a map containing its components (:package and :name).</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L560">view source</a></div></div><div class="public anchor" id="var-parse-path"><h3>parse-path</h3><div class="usage"><code>(parse-path path)</code></div><div class="doc"><pre class="plaintext">Message name and package are extracted from the
directory structure the message is stored at.

Expects:
 path:string The path to the message file.

Returns a map with the packacke name (:package) and the message name (:name).</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L196">view source</a></div></div><div class="public anchor" id="var-primitive-frame"><h3>primitive-frame</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L425">view source</a></div></div><div class="public anchor" id="var-primitive-type"><h3>primitive-type</h3><div class="usage"><code>(primitive-type name)</code></div><div class="doc"><pre class="plaintext">Instaparse leaf transformer for primitive type token.

Expects:
 name:string the name of the type.

Returns a map with the keyworized version of the type (:name) as well as a tag
that marks it as a primitive (:tag).</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L48">view source</a></div></div><div class="public anchor" id="var-serealize-declaration"><h3>serealize-declaration</h3><div class="usage"><code>(serealize-declaration d msgs)</code></div><div class="doc"><pre class="plaintext">Serializes a single declaration back to a string to be used in the md5 calculations.

Expects:
 d:map A single declaration.
 msgs:map The entire message map to be compiled.

Returns the declaration as a string formatted like
a line generated by the ros tool `gendeps`.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L284">view source</a></div></div><div class="public anchor" id="var-serialize-id"><h3>serialize-id</h3><div class="usage"><code>(serialize-id id)</code></div><div class="doc"><pre class="plaintext">Ros employs package/message ids to identify message definitions.
Handling these as clojure maps is a bit nicer.
Inverse of `parse-id`.

Expects:
 id:string A message definition id map with the keys [:package :name].

Returns a message definition id string of the form `package_name/message_name`.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L573">view source</a></div></div><div class="public anchor" id="var-transform-parse"><h3>transform-parse</h3><div class="usage"><code>(transform-parse parse-res)</code></div><div class="doc"><pre class="plaintext">Instaparse tree transformer to be used on message declaration parsing results.

Expects:
 parse-tree: instaparse-tree The parse three to be transformed.

Returns a workable list of declarations.</pre></div><div class="src-link"><a href="http://github.com/code-iai/asimov/blob/master/src/asimov/message.clj#L74">view source</a></div></div></div></body></html>